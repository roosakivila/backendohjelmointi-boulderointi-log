<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link type="text/css" rel="stylesheet" href="/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">
	<title th:attr="text=#{page.title.addproject}">Add project</title>
</head>

<body>
	<div th:replace="fragments :: siteHeader"></div>
	<div class="container mt-5">
		<div class="card shadow-sm p-4">
			<h1 th:text="#{page.title.addproject}">Add project</h1>

			<!-- Gym selection form -->
			<form th:action="@{/addproject}" method="get" class="mb-3">
				<div class="mb-3">
					<label for="gymlist" class="form-label" th:text="#{form.label.selectgym}">Gym:</label>
					<div class="input-group">
						<select id="gymlist" name="gymId" class="form-select">
							<option value="" th:text="#{form.label.allgyms}">-- All gyms --</option>
							<option th:each="gym : ${gyms}" th:value="${gym.gymId}" th:text="${gym.name}"
								th:selected="${selectedGymId != null and selectedGymId == gym.gymId}">
							</option>
						</select>
						<button type="submit" class="btn btn-primary" th:text="#{button.filterroutes}">Filter
							Routes</button>
					</div>
					<div class="form-text">
						<span th:text="#{message.filterroutes}">Press filter routes to see available routes</span>
					</div>
				</div>
			</form>

			<!-- Main project form -->
			<form th:object="${project}" th:action="@{saveproject}" action="#" method="post">
				<div class="mb-3">
					<label for="routelist" class="form-label" th:text="#{form.label.routename}">Route name:</label>
					<select id="routelist" class="form-select" th:field="*{route}"
						th:class="${#fields.hasErrors('route')} ? 'form-select is-invalid' : 'form-select'">
						<option value="" th:text="#{form.label.selectroute}">-- Select a route --</option>
						<option th:each="route : ${routes}" th:value="${route.routeId}"
							th:text="${route.name + ' (' + route.grade + ')'}">
						</option>
					</select>
					<div class="invalid-feedback" th:if="${#fields.hasErrors('route')}">
						<span th:errors="*{route}">Route errors</span>
					</div>
					<div th:if="${selectedGymId == null}" class="form-text">
						<span th:text="#{message.selectgymtoroutes}"></span>
					</div>
				</div>
				<div>
					<a th:if="${selectedGymId != null}"
						th:href="@{/addroute(redirect='/addproject?gymId=' + ${selectedGymId})}" class="btn btn-success"
						th:text="#{button.addroute}">Add Route</a>
					<a th:if="${selectedGymId == null}" th:href="@{/addroute(redirect='/addproject')}"
						class="btn btn-success" th:text="#{button.addroute}">Add Route</a>
				</div>
				<div class="mb-3">
					<label for="statuslist" class="form-label" th:text="#{form.label.status}">Status:</label>
					<select id="statuslist" class="form-select" th:field="*{status}"
						th:class="${#fields.hasErrors('status')} ? 'form-select is-invalid' : 'form-select'">
						<option th:each="st : ${statuses}" th:value="${st.name()}"
							th:text="#{'status.' + ${st.name()}}">
						</option>
					</select>
					<div class="invalid-feedback" th:if="${#fields.hasErrors('status')}">
						<span th:errors="*{status}">Status errors</span>
					</div>
				</div>
				<div class="mb-3">
					<label for="attempts" class="form-label" th:text="#{form.label.attempts}">Attempts:</label>
					<input type="number" class="form-control" id="attempts" th:field="*{attempts}"
						th:class="${#fields.hasErrors('attempts')} ? 'form-control is-invalid' : 'form-control'" />
					<div class="invalid-feedback" th:if="${#fields.hasErrors('attempts')}">
						<span th:errors="*{attempts}">Attempts errors</span>
					</div>
				</div>
				<div class="mb-3">
					<label for="notes" class="form-label" th:text="#{form.label.notes}">Notes:</label>
					<textarea class="form-control" id="notes" th:field="*{notes}" rows="4"
						th:class="${#fields.hasErrors('notes')} ? 'form-control is-invalid' : 'form-control'"></textarea>
					<div class="invalid-feedback" th:if="${#fields.hasErrors('notes')}">
						<span th:errors="*{notes}">Notes errors</span>
					</div>
				</div>

				<input type="submit" th:value="#{button.save}" class="btn btn-success"></input>
			</form>
		</div>
	</div>

</body>

</html>