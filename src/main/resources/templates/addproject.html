<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link type="text/css" rel="stylesheet" href="/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}">
	<title>Add project</title>
</head>

<body>
	<div th:replace="fragments :: siteHeader"></div>
	<div class="container mt-5">
		<div class="card shadow-sm p-4">
			<h1>Add project</h1>

			<!-- Gym selection form -->
			<form th:action="@{/addproject}" method="get" class="mb-3">
				<div class="mb-3">
					<label for="gymlist" class="form-label">Gym:</label>
					<div class="input-group">
						<select id="gymlist" name="gymId" class="form-select">
							<option value="">-- All gyms --</option>
							<option th:each="gym : ${gyms}" th:value="${gym.gymId}" th:text="${gym.name}"
								th:selected="${selectedGymId != null and selectedGymId == gym.gymId}">
							</option>
						</select>
						<button type="submit" class="btn btn-primary">Filter Routes</button>
					</div>
				</div>
			</form>

			<!-- Main project form -->
			<form th:object="${project}" th:action="@{saveproject}" action="#" method="post">
				<div class="mb-3">
					<label for="routelist" class="form-label">Route name:</label>
					<select id="routelist" class="form-select" th:field="*{route}">
						<option value="">-- Select a route --</option>
						<option th:each="route : ${routes}" th:value="${route.routeId}"
							th:text="${route.name + ' (' + route.grade + ')'}">
						</option>
					</select>
					<div th:if="${selectedGymId == null}" class="form-text">
						Please select a gym above to see available routes.
					</div>
				</div>
				<div><a th:href="@{/addroute(redirect='/addproject' + (selectedGymId != null ? '?gymId=' + selectedGymId : ''))}"
						class="btn btn-success">Add Route</a></div>
				<div class="mb-3">
					<label for="statuslist" class="form-label">Status:</label>
					<select id="statuslist" class="form-select" th:field="*{status}">
						<option th:each="st : ${statuses}" th:value="${st.name()}" th:text="${st}">
						</option>
					</select>
				</div>
				<div class="mb-3">
					<label for="attempts" class="form-label">Attempts:</label>
					<input type="number" class="form-control" id="attempts" th:field="*{attempts}"
						th:class="${#fields.hasErrors('attempts')} ? 'form-control is-invalid' : 'form-control'" />
					<div class="invalid-feedback" th:if="${#fields.hasErrors('attempts')}">
						<span th:errors="*{attempts}">Attempts errors</span>
					</div>
				</div>
				<div class="mb-3">
					<label for="notes" class="form-label">Notes:</label>
					<textarea class="form-control" id="notes" th:field="*{notes}" rows="4"
						th:class="${#fields.hasErrors('notes')} ? 'form-control is-invalid' : 'form-control'"></textarea>
					<div class="invalid-feedback" th:if="${#fields.hasErrors('notes')}">
						<span th:errors="*{notes}">Notes errors</span>
					</div>
				</div>

				<input type="submit" value="Save" class="btn btn-success"></input>
			</form>
		</div>
	</div>

</body>

</html>